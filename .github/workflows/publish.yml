on:
  workflow_dispatch:
  push:
    branches: main

name: Publish Website

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install package (docs)
        run: |
          python -m pip install --upgrade pip
          pip install -e ".[docs]"

      - name: Build Sphinx HTML
        run: |
          sphinx-build -W -b html docs docs/_build/html

      - name: Set up Quarto
        uses: quarto-dev/quarto-actions/setup@v2

      - name: Render Quarto slides
        run: |
          quarto render slides/emidm_intro1.qmd --no-execute

      - name: Copy Quarto slides into Sphinx site
        run: |
          mkdir -p docs/_build/html/slides

          # Without _quarto.yml, Quarto outputs directly to slides/
          cp -r slides/emidm_intro1.html docs/_build/html/slides/
          if [ -d slides/emidm_intro1_files ]; then cp -r slides/emidm_intro1_files docs/_build/html/slides/; fi

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: docs/_build/html